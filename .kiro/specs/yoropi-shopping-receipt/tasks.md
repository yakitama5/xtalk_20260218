# 実装計画: Yoropic（ヨロピック）

## 概要

Yoropic（ヨロピック）の実装を段階的に進めるためのタスクリストです。各タスクは前のタスクの成果物を基に構築され、最終的に完全に統合されたアプリケーションを作成します。

## タスク

- [ ] 1. プロジェクト構造とコア依存関係の設定
  - pubspec.yamlに必要な依存関係を追加（riverpod, share_plus, path_provider, google_fonts, gap, fake, flutter_vibrate）
  - lib/ディレクトリ内にfeature-firstアーキテクチャのフォルダ構造を作成
  - 基本的なテーマ設定とMaterial Design 3の設定を実装
  - _要件: 全般的なアーキテクチャ要件_

- [ ] 2. コアテーマとカラーシステムの実装
  - [ ] 2.1 Theme Managerの実装
    - lib/core/theme/theme_manager.dartを作成
    - ライトテーマとダークテーマの定義
    - ピンク色（#FFFF4081）を基調としたColorSchemeの実装
    - _要件: 5.1, 5.2, 5.3, 5.4_

  - [ ] 2.2 Haptic Managerの実装
    - lib/core/haptics/haptic_manager.dartを作成
    - ハプティクスフィードバックの種類別実装
    - 端末対応チェック機能
    - _要件: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6_

  - [ ]* 2.3 テーマ管理のプロパティテストを作成
    - **プロパティ 13: テーマ適用の正確性**
    - **検証対象: 要件 5.2, 5.3, 5.4**

  - [ ]* 2.4 ハプティクスのプロパティテストを作成
    - **プロパティ 22: ハプティクス実行の確実性**
    - **検証対象: 要件 7.1, 7.2, 7.3, 7.4, 7.5**

  - [ ]* 2.5 ハプティクス非対応端末のプロパティテストを作成
    - **プロパティ 23: ハプティクス非対応端末の安全性**
    - **検証対象: 要件 7.6**

- [ ] 3. 入力管理機能の実装
  - [ ] 3.1 Input Notifierの実装
    - lib/features/input/application/input_notifier.dartを作成
    - テキスト状態管理とバリデーション機能
    - 改行区切りでのアイテム分割ロジック
    - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_

  - [ ]* 3.2 入力処理のプロパティテストを作成
    - **プロパティ 1: テキスト分割の一貫性**
    - **検証対象: 要件 1.2**

  - [ ]* 3.3 外部テキスト処理のプロパティテストを作成
    - **プロパティ 2: 外部テキスト処理の堅牢性**
    - **検証対象: 要件 1.3**

  - [ ]* 3.4 ボタン状態のプロパティテストを作成
    - **プロパティ 3: ボタン状態の論理的一貫性**
    - **検証対象: 要件 1.5**

- [ ] 4. UI状態管理の実装
  - [ ] 4.1 App Mode Notifierの実装
    - lib/core/application/app_mode_notifier.dartを作成
    - 入力モードとプレビューモード間の状態遷移
    - UI要素の表示/非表示制御
    - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

  - [ ]* 4.2 状態遷移のプロパティテストを作成
    - **プロパティ 8: 状態遷移の双方向性**
    - **検証対象: 要件 3.2, 3.4**

  - [ ]* 4.3 UI状態管理のプロパティテストを作成
    - **プロパティ 9: UI状態の一貫性**
    - **検証対象: 要件 3.3, 3.5**

- [ ] 5. チェックポイント - 基本状態管理の確認
  - すべてのテストが通ることを確認し、質問があれば尋ねる

- [ ] 6. レシート生成コンポーネントの実装
  - [ ] 6.1 データモデルの作成
    - lib/features/receipt/domain/receipt_data.dartを作成
    - ReceiptDataクラスとAppConfigurationクラスの実装
    - JSON変換メソッドの実装
    - _要件: 2.1, 2.2, 2.3, 2.4_

  - [ ] 6.2 カスタムクリッパーの実装
    - lib/features/receipt/presentation/widgets/receipt_clipper.dartを作成
    - ギザギザ形状を生成するCustomClipperの実装
    - _要件: 2.5_

  - [ ]* 6.3 ギザギザ形状のプロパティテストを作成
    - **プロパティ 6: ギザギザ形状の適用**
    - **検証対象: 要件 2.5**

  - [ ] 6.4 Receipt Cardウィジェットの実装
    - lib/features/receipt/presentation/widgets/receipt_card.dartを作成
    - レシート風デザインのWidget実装
    - ヘッダー、ボディ、フッターの各セクション
    - ダークモード対応の色設定
    - _要件: 2.1, 2.2, 2.3, 2.4, 2.6_

  - [ ]* 6.5 レシート生成のプロパティテストを作成
    - **プロパティ 4: レシート生成の完全性**
    - **検証対象: 要件 2.1**

  - [ ]* 6.6 レシート要素のプロパティテストを作成
    - **プロパティ 5: レシート要素の包含性**
    - **検証対象: 要件 2.2, 2.3, 2.4**

  - [ ]* 6.7 色設定のプロパティテストを作成
    - **プロパティ 7: 色設定の正確性**
    - **検証対象: 要件 2.6**

- [ ] 7. テキスト処理とレイアウト調整の実装
  - [ ] 7.1 テキスト処理ユーティリティの実装
    - lib/core/utils/text_utils.dartを作成
    - 長文の改行処理、空行フィルタリング
    - 特殊文字と多言語テキストの処理
    - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

  - [ ]* 7.2 長文レイアウトのプロパティテストを作成
    - **プロパティ 15: 長文レイアウトの適応性**
    - **検証対象: 要件 6.1**

  - [ ]* 7.3 動的高さ調整のプロパティテストを作成
    - **プロパティ 16: 動的高さ調整**
    - **検証対象: 要件 6.2**

  - [ ]* 7.4 空行フィルタリングのプロパティテストを作成
    - **プロパティ 17: 空行フィルタリング**
    - **検証対象: 要件 6.3**

  - [ ]* 7.5 特殊文字処理のプロパティテストを作成
    - **プロパティ 18: 特殊文字処理の堅牢性**
    - **検証対象: 要件 6.4**

  - [ ]* 7.6 多言語フォントのプロパティテストを作成
    - **プロパティ 19: 多言語フォント適用**
    - **検証対象: 要件 6.5**

- [ ] 8. 画像生成とシェア機能の実装
  - [ ] 8.1 Receipt Serviceの実装
    - lib/features/receipt/application/receipt_service.dartを作成
    - RepaintBoundaryを使用した画像変換機能
    - 高画質（pixelRatio 3.0以上）での画像生成
    - エラーハンドリングとリカバリ機能
    - ハプティクスフィードバックの統合（成功・エラー通知）
    - _要件: 4.1, 4.3, 4.4, 7.4, 7.5_

  - [ ] 8.2 Share Serviceの実装
    - lib/core/services/share_service.dartを作成
    - share_plusパッケージを使用したシェア機能
    - 一時ファイル管理とクリーンアップ
    - _要件: 4.2, 4.5_

  - [ ]* 8.3 画像変換のプロパティテストを作成
    - **プロパティ 10: 画像変換の成功性**
    - **検証対象: 要件 4.1**

  - [ ]* 8.4 画像品質のプロパティテストを作成
    - **プロパティ 11: 画像品質の保証**
    - **検証対象: 要件 4.3**

  - [ ]* 8.5 エラー処理のプロパティテストを作成
    - **プロパティ 12: エラー処理の安全性**
    - **検証対象: 要件 4.4**

- [ ] 9. メイン画面UIの実装
  - [ ] 9.1 入力画面の実装
    - lib/features/input/presentation/input_screen.dartを作成
    - テキスト入力エリアとプレビューボタン
    - キーボードフォーカス管理
    - ハプティクスフィードバックの統合
    - _要件: 1.1, 1.4, 1.5, 7.1_

  - [ ] 9.2 プレビュー画面の実装
    - lib/features/receipt/presentation/preview_screen.dartを作成
    - レシートカードの表示
    - シェアボタンと修正ボタン
    - ハプティクスフィードバックの統合
    - _要件: 3.2, 3.3, 3.4, 3.5, 7.2, 7.3_

  - [ ]* 9.3 UI初期状態のユニットテストを作成
    - アプリ起動時の初期状態確認
    - _要件: 1.1, 3.1_

- [ ] 10. チェックポイント - コア機能の統合確認
  - すべてのテストが通ることを確認し、質問があれば尋ねる

- [ ] 11. メインアプリケーションの統合
  - [ ] 11.1 App.dartの実装
    - lib/app.dartを作成
    - MaterialAppの設定とテーマ適用
    - Riverpodプロバイダーの設定
    - _要件: 5.1, 5.5_

  - [ ] 11.2 main.dartの更新
    - アプリケーションエントリーポイントの実装
    - ProviderScopeでのアプリ起動
    - _要件: 全般_

  - [ ]* 11.3 テーマ連動のプロパティテストを作成
    - **プロパティ 14: テーマ連動の一貫性**
    - **検証対象: 要件 5.5**

- [ ] 12. エラーハンドリングとシステム安定性の実装
  - [ ] 12.1 エラーハンドリングの実装
    - lib/core/utils/error_handler.dartを作成
    - メモリ不足、ネットワークエラーの処理
    - ユーザーフレンドリーなエラーメッセージ
    - _要件: 8.4, 8.5_

  - [ ]* 12.2 メモリエラー処理のプロパティテストを作成
    - **プロパティ 20: メモリエラー処理**
    - **検証対象: 要件 8.4**

  - [ ]* 12.3 オフライン機能のプロパティテストを作成
    - **プロパティ 21: オフライン機能の保証**
    - **検証対象: 要件 8.5**

- [ ] 13. 統合テストとエンドツーエンドテスト
  - [ ]* 13.1 エンドツーエンド統合テストを作成
    - 入力→プレビュー→シェアの完全なフローテスト
    - テーマ切り替えテスト
    - エラーリカバリテスト
    - _要件: 全般的なユーザージャーニー_

- [ ] 14. 最終チェックポイント - 完全な機能確認
  - すべてのテストが通ることを確認し、質問があれば尋ねる

## 注意事項

- `*`マークが付いたタスクはオプションで、より高速なMVP開発のためにスキップ可能
- 各タスクは特定の要件への追跡可能性のために要件番号を参照
- チェックポイントは段階的な検証を保証
- プロパティテストは汎用的な正確性プロパティを検証
- 単体テストは特定の例とエッジケースを検証
- すべてのプロパティテストは最低100回の反復で実行される
- 各プロパティテストは設計書の対応するプロパティを参照するタグを含む
